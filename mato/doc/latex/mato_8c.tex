\hypertarget{mato_8c}{}\doxysection{mato.\+c File Reference}
\label{mato_8c}\index{mato.c@{mato.c}}
{\ttfamily \#include \char`\"{}mato.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}mato\+\_\+core.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}mato\+\_\+net.\+h\char`\"{}}\newline
Include dependency graph for mato.\+c\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{mato_8c__incl}
\end{center}
\end{figure}
\doxysubsection*{Functions}
\begin{DoxyCompactItemize}
\item 
\mbox{\Hypertarget{mato_8c_a31f3887a8e72dc1323b6bfbcfbf9d038}\label{mato_8c_a31f3887a8e72dc1323b6bfbcfbf9d038}} 
void \mbox{\hyperlink{mato_8c_a31f3887a8e72dc1323b6bfbcfbf9d038}{mato\+\_\+init}} (int this\+\_\+node\+\_\+identifier)
\begin{DoxyCompactList}\small\item\em Initializes the framework. It must be the first function of the framework to be called. It should be called only once. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{mato_8c_a43f0570e3ab59d7a021e93113437dcaf}{mato\+\_\+register\+\_\+new\+\_\+type\+\_\+of\+\_\+module}} (char $\ast$type, \mbox{\hyperlink{structmodule__specification}{module\+\_\+specification}} $\ast$specification)
\begin{DoxyCompactList}\small\item\em Register a new module type. \end{DoxyCompactList}\item 
int \mbox{\hyperlink{mato_8c_a411a20bcfa908edbebe617fe5cc54667}{mato\+\_\+create\+\_\+new\+\_\+module\+\_\+instance}} (const char $\ast$module\+\_\+type, const char $\ast$module\+\_\+name)
\begin{DoxyCompactList}\small\item\em The main program (or other module) can call this function to request creation of a module instance. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{mato_8c_a62a0865fa5114c0a254435a1369531cf}{mato\+\_\+start\+\_\+module}} (int module\+\_\+id)
\begin{DoxyCompactList}\small\item\em Start a newly created instance of a particular module. \end{DoxyCompactList}\item 
\mbox{\Hypertarget{mato_8c_a02ef7e731c9c9eaa342352a7e802c183}\label{mato_8c_a02ef7e731c9c9eaa342352a7e802c183}} 
void \mbox{\hyperlink{mato_8c_a02ef7e731c9c9eaa342352a7e802c183}{mato\+\_\+start}} ()
\begin{DoxyCompactList}\small\item\em Start the framework and all modules. This is typically called after all module instances have been created. \end{DoxyCompactList}\item 
\mbox{\Hypertarget{mato_8c_a6e94d7d4dc09ad58485227e60df20035}\label{mato_8c_a6e94d7d4dc09ad58485227e60df20035}} 
void \mbox{\hyperlink{mato_8c_a6e94d7d4dc09ad58485227e60df20035}{mato\+\_\+delete\+\_\+module\+\_\+instance}} (int module\+\_\+id)
\begin{DoxyCompactList}\small\item\em Allows to dynamically delete a module instance that was previously created. \end{DoxyCompactList}\item 
\mbox{\Hypertarget{mato_8c_aa753d75335e7a6ae0e00a6dcdbdb1412}\label{mato_8c_aa753d75335e7a6ae0e00a6dcdbdb1412}} 
int \mbox{\hyperlink{mato_8c_aa753d75335e7a6ae0e00a6dcdbdb1412}{mato\+\_\+get\+\_\+module\+\_\+id}} (const char $\ast$module\+\_\+name)
\begin{DoxyCompactList}\small\item\em Translate a module name of some existing module instance to its module id. Returns -\/1, if module name is not known. \end{DoxyCompactList}\item 
\mbox{\Hypertarget{mato_8c_a2e839c2dcf0c134166ceca799e7987fd}\label{mato_8c_a2e839c2dcf0c134166ceca799e7987fd}} 
char $\ast$ \mbox{\hyperlink{mato_8c_a2e839c2dcf0c134166ceca799e7987fd}{mato\+\_\+get\+\_\+module\+\_\+name}} (int module\+\_\+id)
\begin{DoxyCompactList}\small\item\em Determine the name of a module with the specified module\+\_\+id. \end{DoxyCompactList}\item 
\mbox{\Hypertarget{mato_8c_a28a6ba77196f8504bab5f3da059c5d5b}\label{mato_8c_a28a6ba77196f8504bab5f3da059c5d5b}} 
char $\ast$ \mbox{\hyperlink{mato_8c_a28a6ba77196f8504bab5f3da059c5d5b}{mato\+\_\+get\+\_\+module\+\_\+type}} (int module\+\_\+id)
\begin{DoxyCompactList}\small\item\em Determine the type of a module with the specified module\+\_\+id. \end{DoxyCompactList}\item 
\mbox{\Hypertarget{mato_8c_af07c3febed32408feb8a11c4d66c2251}\label{mato_8c_af07c3febed32408feb8a11c4d66c2251}} 
int \mbox{\hyperlink{mato_8c_af07c3febed32408feb8a11c4d66c2251}{mato\+\_\+subscribe}} (int subscriber\+\_\+module\+\_\+id, int subscribed\+\_\+module\+\_\+id, int channel, \mbox{\hyperlink{mato_8h_a9345221b935d9505595c583b54d31e86}{subscriber\+\_\+callback}} callback, int subscription\+\_\+type)
\begin{DoxyCompactList}\small\item\em Subscribe on a channel of some module instance. Returns a number that represents this subscription (a subscription\+\_\+id). \end{DoxyCompactList}\item 
\mbox{\Hypertarget{mato_8c_a14f9462b777a24c86af37b64d84142d0}\label{mato_8c_a14f9462b777a24c86af37b64d84142d0}} 
void \mbox{\hyperlink{mato_8c_a14f9462b777a24c86af37b64d84142d0}{mato\+\_\+unsubscribe}} (int module\+\_\+id, int channel, int subscription\+\_\+id)
\begin{DoxyCompactList}\small\item\em Given a subscription\+\_\+id, cancel the ongoing subscription to a channel of some module instance. \end{DoxyCompactList}\item 
\mbox{\Hypertarget{mato_8c_a7c5249cc4fbb65587357c130ab618427}\label{mato_8c_a7c5249cc4fbb65587357c130ab618427}} 
void $\ast$ \mbox{\hyperlink{mato_8c_a7c5249cc4fbb65587357c130ab618427}{mato\+\_\+get\+\_\+data\+\_\+buffer}} (int size)
\begin{DoxyCompactList}\small\item\em Allocate a memory for a new message to be posted with post\+\_\+data. \end{DoxyCompactList}\item 
\mbox{\Hypertarget{mato_8c_aebd06bdcd1d952465c8c222c663d76fb}\label{mato_8c_aebd06bdcd1d952465c8c222c663d76fb}} 
void \mbox{\hyperlink{mato_8c_aebd06bdcd1d952465c8c222c663d76fb}{mato\+\_\+post\+\_\+data}} (int id\+\_\+of\+\_\+posting\+\_\+module, int channel, int data\+\_\+length, void $\ast$data)
\begin{DoxyCompactList}\small\item\em A module instance posts a new message to its own output data channel by calling this function. \end{DoxyCompactList}\item 
\mbox{\Hypertarget{mato_8c_ae76f55dbca38f9a69095cda5f089a80b}\label{mato_8c_ae76f55dbca38f9a69095cda5f089a80b}} 
int \mbox{\hyperlink{mato_8c_ae76f55dbca38f9a69095cda5f089a80b}{mato\+\_\+send\+\_\+global\+\_\+message}} (int module\+\_\+id\+\_\+sender, int message\+\_\+id, int msg\+\_\+length, void $\ast$message\+\_\+data)
\begin{DoxyCompactList}\small\item\em The main program or any module instance can post a global message to be posted to all modules immediatelly in the same thread by calling this function. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{mato_8c_af356c7284b6f1d6be285de40d9e23b77}{mato\+\_\+get\+\_\+data}} (int id\+\_\+module, int channel, int $\ast$data\+\_\+length, void $\ast$$\ast$data)
\begin{DoxyCompactList}\small\item\em Retrieve the most recently posted data of some channel of some module instance. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{mato_8c_af3c84af45ac99910057189ede367d72d}{mato\+\_\+borrow\+\_\+data}} (int id\+\_\+module, int channel, int $\ast$data\+\_\+length, void $\ast$$\ast$data)
\begin{DoxyCompactList}\small\item\em Retrieve the most recently posted data of some channel of some module instance. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{mato_8c_aedcb803fd4a991e805e6c3813c829a35}{mato\+\_\+release\+\_\+data}} (int id\+\_\+module, int channel, void $\ast$data)
\begin{DoxyCompactList}\small\item\em Return a borrowed pointer that was obtained either by \mbox{\hyperlink{mato_8h_af3c84af45ac99910057189ede367d72d}{mato\+\_\+borrow\+\_\+data()}} or by a callback in the borrowed\+\_\+pointer mode. \end{DoxyCompactList}\item 
\mbox{\Hypertarget{mato_8c_a89c5f00aa3a55188b8a2364314a0b644}\label{mato_8c_a89c5f00aa3a55188b8a2364314a0b644}} 
int \mbox{\hyperlink{mato_8c_a89c5f00aa3a55188b8a2364314a0b644}{mato\+\_\+get\+\_\+number\+\_\+of\+\_\+modules}} ()
\begin{DoxyCompactList}\small\item\em Retrieve the number of currently running modules. \end{DoxyCompactList}\item 
G\+Array $\ast$ \mbox{\hyperlink{mato_8c_a5c6a3a9b7e7969e9d9324b1d937ff2a5}{mato\+\_\+get\+\_\+list\+\_\+of\+\_\+all\+\_\+modules}} ()
\begin{DoxyCompactList}\small\item\em Retrieve the list of currently running modules. \end{DoxyCompactList}\item 
G\+Array $\ast$ \mbox{\hyperlink{mato_8c_ac8c86d7dbb7acd09f1884c2e80ec698c}{mato\+\_\+get\+\_\+list\+\_\+of\+\_\+modules}} (char $\ast$type)
\begin{DoxyCompactList}\small\item\em Retrieve the list of currently running modules of the specified type. \end{DoxyCompactList}\item 
\mbox{\Hypertarget{mato_8c_aeafc9d85e29a73b9b5423cd661bd54c2}\label{mato_8c_aeafc9d85e29a73b9b5423cd661bd54c2}} 
void \mbox{\hyperlink{mato_8c_aeafc9d85e29a73b9b5423cd661bd54c2}{mato\+\_\+free\+\_\+list\+\_\+of\+\_\+modules}} (G\+Array $\ast$a)
\begin{DoxyCompactList}\small\item\em Free the list of modules returned by either of the two functions \mbox{\hyperlink{mato_8h_ac8c86d7dbb7acd09f1884c2e80ec698c}{mato\+\_\+get\+\_\+list\+\_\+of\+\_\+modules()}} or \mbox{\hyperlink{mato_8h_ac8c86d7dbb7acd09f1884c2e80ec698c}{mato\+\_\+get\+\_\+list\+\_\+of\+\_\+modules()}}. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{mato_8c_ab49165685fd95d2e9f70f484e367c6f2}{mato\+\_\+data\+\_\+buffer\+\_\+usage}} (int module\+\_\+id, int channel, int $\ast$number\+\_\+of\+\_\+allocated\+\_\+buffers, int $\ast$total\+\_\+sum\+\_\+of\+\_\+ref\+\_\+count)
\begin{DoxyCompactList}\small\item\em Provide a diagnostic information on use of the buffers by a particular channel of a particular module. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{mato_8c_a6b31044a7afec17426ec4d4e3354aa9f}{mato\+\_\+inc\+\_\+thread\+\_\+count}} ()
\begin{DoxyCompactList}\small\item\em Each module instance (or other part of the program) that creates a new thread should call this funciton for each newly created thread. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{mato_8c_a480acc181ff3a7d7c925d64e3d4a7442}{mato\+\_\+dec\+\_\+thread\+\_\+count}} ()
\begin{DoxyCompactList}\small\item\em Each thread that terminates should call this function just before it quits. \end{DoxyCompactList}\item 
\mbox{\Hypertarget{mato_8c_a314629d6f743c699b26a534175986865}\label{mato_8c_a314629d6f743c699b26a534175986865}} 
int \mbox{\hyperlink{mato_8c_a314629d6f743c699b26a534175986865}{mato\+\_\+threads\+\_\+running}} ()
\begin{DoxyCompactList}\small\item\em The number of threads currently running in the system. \end{DoxyCompactList}\item 
\mbox{\Hypertarget{mato_8c_ae1a30212d4d2d4f1121684dbd1bb854a}\label{mato_8c_ae1a30212d4d2d4f1121684dbd1bb854a}} 
void \mbox{\hyperlink{mato_8c_ae1a30212d4d2d4f1121684dbd1bb854a}{mato\+\_\+shutdown}} ()
\begin{DoxyCompactList}\small\item\em Releases all resources used by the framework, recommended to be called before the main program terminates. \end{DoxyCompactList}\end{DoxyCompactItemize}


\doxysubsection{Detailed Description}
Implementation of the Mato control framework\+: public functions. 

\doxysubsection{Function Documentation}
\mbox{\Hypertarget{mato_8c_af3c84af45ac99910057189ede367d72d}\label{mato_8c_af3c84af45ac99910057189ede367d72d}} 
\index{mato.c@{mato.c}!mato\_borrow\_data@{mato\_borrow\_data}}
\index{mato\_borrow\_data@{mato\_borrow\_data}!mato.c@{mato.c}}
\doxysubsubsection{\texorpdfstring{mato\_borrow\_data()}{mato\_borrow\_data()}}
{\footnotesize\ttfamily void mato\+\_\+borrow\+\_\+data (\begin{DoxyParamCaption}\item[{int}]{id\+\_\+module,  }\item[{int}]{channel,  }\item[{int $\ast$}]{data\+\_\+length,  }\item[{void $\ast$$\ast$}]{data }\end{DoxyParamCaption})}



Retrieve the most recently posted data of some channel of some module instance. 

In this case, the data is not copied, but a pointer to read-\/only memory containing the data is provided. The module should return the borrowed pointer back to the framework by calling \mbox{\hyperlink{mato_8h_aedcb803fd4a991e805e6c3813c829a35}{mato\+\_\+release\+\_\+data()}} when the data is not needed anymore. \mbox{\Hypertarget{mato_8c_a411a20bcfa908edbebe617fe5cc54667}\label{mato_8c_a411a20bcfa908edbebe617fe5cc54667}} 
\index{mato.c@{mato.c}!mato\_create\_new\_module\_instance@{mato\_create\_new\_module\_instance}}
\index{mato\_create\_new\_module\_instance@{mato\_create\_new\_module\_instance}!mato.c@{mato.c}}
\doxysubsubsection{\texorpdfstring{mato\_create\_new\_module\_instance()}{mato\_create\_new\_module\_instance()}}
{\footnotesize\ttfamily int mato\+\_\+create\+\_\+new\+\_\+module\+\_\+instance (\begin{DoxyParamCaption}\item[{const char $\ast$}]{module\+\_\+type,  }\item[{const char $\ast$}]{module\+\_\+name }\end{DoxyParamCaption})}



The main program (or other module) can call this function to request creation of a module instance. 

The function returns the new module id. \mbox{\Hypertarget{mato_8c_ab49165685fd95d2e9f70f484e367c6f2}\label{mato_8c_ab49165685fd95d2e9f70f484e367c6f2}} 
\index{mato.c@{mato.c}!mato\_data\_buffer\_usage@{mato\_data\_buffer\_usage}}
\index{mato\_data\_buffer\_usage@{mato\_data\_buffer\_usage}!mato.c@{mato.c}}
\doxysubsubsection{\texorpdfstring{mato\_data\_buffer\_usage()}{mato\_data\_buffer\_usage()}}
{\footnotesize\ttfamily void mato\+\_\+data\+\_\+buffer\+\_\+usage (\begin{DoxyParamCaption}\item[{int}]{module\+\_\+id,  }\item[{int}]{channel,  }\item[{int $\ast$}]{number\+\_\+of\+\_\+allocated\+\_\+buffers,  }\item[{int $\ast$}]{total\+\_\+sum\+\_\+of\+\_\+ref\+\_\+count }\end{DoxyParamCaption})}



Provide a diagnostic information on use of the buffers by a particular channel of a particular module. 

If this starts growing, the callbacks take too much time to process data and should be refactored. \mbox{\Hypertarget{mato_8c_a480acc181ff3a7d7c925d64e3d4a7442}\label{mato_8c_a480acc181ff3a7d7c925d64e3d4a7442}} 
\index{mato.c@{mato.c}!mato\_dec\_thread\_count@{mato\_dec\_thread\_count}}
\index{mato\_dec\_thread\_count@{mato\_dec\_thread\_count}!mato.c@{mato.c}}
\doxysubsubsection{\texorpdfstring{mato\_dec\_thread\_count()}{mato\_dec\_thread\_count()}}
{\footnotesize\ttfamily void mato\+\_\+dec\+\_\+thread\+\_\+count (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}



Each thread that terminates should call this function just before it quits. 

Decrement the number of threads running. It should be called by each thread that terminates. \mbox{\Hypertarget{mato_8c_af356c7284b6f1d6be285de40d9e23b77}\label{mato_8c_af356c7284b6f1d6be285de40d9e23b77}} 
\index{mato.c@{mato.c}!mato\_get\_data@{mato\_get\_data}}
\index{mato\_get\_data@{mato\_get\_data}!mato.c@{mato.c}}
\doxysubsubsection{\texorpdfstring{mato\_get\_data()}{mato\_get\_data()}}
{\footnotesize\ttfamily void mato\+\_\+get\+\_\+data (\begin{DoxyParamCaption}\item[{int}]{id\+\_\+module,  }\item[{int}]{channel,  }\item[{int $\ast$}]{data\+\_\+length,  }\item[{void $\ast$$\ast$}]{data }\end{DoxyParamCaption})}



Retrieve the most recently posted data of some channel of some module instance. 

Data is copied into new buffer allocated and its pointer is returned in data variable, and the length of the data is set to data\+\_\+length. The calling module should release the memory by calling free() when it is not needed anymore. \mbox{\Hypertarget{mato_8c_a5c6a3a9b7e7969e9d9324b1d937ff2a5}\label{mato_8c_a5c6a3a9b7e7969e9d9324b1d937ff2a5}} 
\index{mato.c@{mato.c}!mato\_get\_list\_of\_all\_modules@{mato\_get\_list\_of\_all\_modules}}
\index{mato\_get\_list\_of\_all\_modules@{mato\_get\_list\_of\_all\_modules}!mato.c@{mato.c}}
\doxysubsubsection{\texorpdfstring{mato\_get\_list\_of\_all\_modules()}{mato\_get\_list\_of\_all\_modules()}}
{\footnotesize\ttfamily G\+Array$\ast$ mato\+\_\+get\+\_\+list\+\_\+of\+\_\+all\+\_\+modules (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}



Retrieve the list of currently running modules. 

The list should be freed by calling \mbox{\hyperlink{mato_8h_aeafc9d85e29a73b9b5423cd661bd54c2}{mato\+\_\+free\+\_\+list\+\_\+of\+\_\+modules()}} when it is not needed anymore. \mbox{\Hypertarget{mato_8c_ac8c86d7dbb7acd09f1884c2e80ec698c}\label{mato_8c_ac8c86d7dbb7acd09f1884c2e80ec698c}} 
\index{mato.c@{mato.c}!mato\_get\_list\_of\_modules@{mato\_get\_list\_of\_modules}}
\index{mato\_get\_list\_of\_modules@{mato\_get\_list\_of\_modules}!mato.c@{mato.c}}
\doxysubsubsection{\texorpdfstring{mato\_get\_list\_of\_modules()}{mato\_get\_list\_of\_modules()}}
{\footnotesize\ttfamily G\+Array$\ast$ mato\+\_\+get\+\_\+list\+\_\+of\+\_\+modules (\begin{DoxyParamCaption}\item[{char $\ast$}]{type }\end{DoxyParamCaption})}



Retrieve the list of currently running modules of the specified type. 

The list should be freed by calling \mbox{\hyperlink{mato_8h_aeafc9d85e29a73b9b5423cd661bd54c2}{mato\+\_\+free\+\_\+list\+\_\+of\+\_\+modules()}} when it is not needed anymore. \mbox{\Hypertarget{mato_8c_a6b31044a7afec17426ec4d4e3354aa9f}\label{mato_8c_a6b31044a7afec17426ec4d4e3354aa9f}} 
\index{mato.c@{mato.c}!mato\_inc\_thread\_count@{mato\_inc\_thread\_count}}
\index{mato\_inc\_thread\_count@{mato\_inc\_thread\_count}!mato.c@{mato.c}}
\doxysubsubsection{\texorpdfstring{mato\_inc\_thread\_count()}{mato\_inc\_thread\_count()}}
{\footnotesize\ttfamily void mato\+\_\+inc\+\_\+thread\+\_\+count (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}



Each module instance (or other part of the program) that creates a new thread should call this funciton for each newly created thread. 

Increments the number of threads running. This should be called from each thread that has been started. \mbox{\Hypertarget{mato_8c_a43f0570e3ab59d7a021e93113437dcaf}\label{mato_8c_a43f0570e3ab59d7a021e93113437dcaf}} 
\index{mato.c@{mato.c}!mato\_register\_new\_type\_of\_module@{mato\_register\_new\_type\_of\_module}}
\index{mato\_register\_new\_type\_of\_module@{mato\_register\_new\_type\_of\_module}!mato.c@{mato.c}}
\doxysubsubsection{\texorpdfstring{mato\_register\_new\_type\_of\_module()}{mato\_register\_new\_type\_of\_module()}}
{\footnotesize\ttfamily void mato\+\_\+register\+\_\+new\+\_\+type\+\_\+of\+\_\+module (\begin{DoxyParamCaption}\item[{char $\ast$}]{type,  }\item[{\mbox{\hyperlink{structmodule__specification}{module\+\_\+specification}} $\ast$}]{specification }\end{DoxyParamCaption})}



Register a new module type. 

This is typically called from the init() function of each module type, which should be called directly from the main program. \mbox{\Hypertarget{mato_8c_aedcb803fd4a991e805e6c3813c829a35}\label{mato_8c_aedcb803fd4a991e805e6c3813c829a35}} 
\index{mato.c@{mato.c}!mato\_release\_data@{mato\_release\_data}}
\index{mato\_release\_data@{mato\_release\_data}!mato.c@{mato.c}}
\doxysubsubsection{\texorpdfstring{mato\_release\_data()}{mato\_release\_data()}}
{\footnotesize\ttfamily void mato\+\_\+release\+\_\+data (\begin{DoxyParamCaption}\item[{int}]{id\+\_\+module,  }\item[{int}]{channel,  }\item[{void $\ast$}]{data }\end{DoxyParamCaption})}



Return a borrowed pointer that was obtained either by \mbox{\hyperlink{mato_8h_af3c84af45ac99910057189ede367d72d}{mato\+\_\+borrow\+\_\+data()}} or by a callback in the borrowed\+\_\+pointer mode. 

The id\+\_\+module and channel specify the origin of the message. \mbox{\Hypertarget{mato_8c_a62a0865fa5114c0a254435a1369531cf}\label{mato_8c_a62a0865fa5114c0a254435a1369531cf}} 
\index{mato.c@{mato.c}!mato\_start\_module@{mato\_start\_module}}
\index{mato\_start\_module@{mato\_start\_module}!mato.c@{mato.c}}
\doxysubsubsection{\texorpdfstring{mato\_start\_module()}{mato\_start\_module()}}
{\footnotesize\ttfamily void mato\+\_\+start\+\_\+module (\begin{DoxyParamCaption}\item[{int}]{module\+\_\+id }\end{DoxyParamCaption})}



Start a newly created instance of a particular module. 

This is typically used when the module instance is created later than when the framework has already been started. 