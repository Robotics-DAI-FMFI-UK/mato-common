\hypertarget{mato__core_8c}{}\doxysection{mato\+\_\+core.\+c File Reference}
\label{mato__core_8c}\index{mato\_core.c@{mato\_core.c}}
{\ttfamily \#include \char`\"{}mato.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}mato\+\_\+net.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}mato\+\_\+core.\+h\char`\"{}}\newline
Include dependency graph for mato\+\_\+core.\+c\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{mato__core_8c__incl}
\end{center}
\end{figure}
\doxysubsection*{Macros}
\begin{DoxyCompactItemize}
\item 
\#define \mbox{\hyperlink{mato__core_8c_a369266c24eacffb87046522897a570d5}{\+\_\+\+G\+N\+U\+\_\+\+S\+O\+U\+R\+CE}}
\end{DoxyCompactItemize}
\doxysubsection*{Functions}
\begin{DoxyCompactItemize}
\item 
void \mbox{\hyperlink{mato__core_8c_a0d4eb232de3e0d9c18edc91eb1316421}{core\+\_\+mato\+\_\+shutdown}} ()
\begin{DoxyCompactList}\small\item\em Release resources used by the core. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{mato__core_8c_a438cf6032d01d451d50cf8cd7b14d8f0}{lock\+\_\+framework}} ()
\begin{DoxyCompactList}\small\item\em Enter mutually-\/exclusive area accessing internal framework data structures. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{mato__core_8c_a39c60cf29218c107f4115b73270a5114}{unlock\+\_\+framework}} ()
\begin{DoxyCompactList}\small\item\em Leave mutually-\/exclusive area with a protected acces to internal framework data structures. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{mato__core_8c_a94a6b505bcf5e3cca4665cba3bbab3cd}{mato\+\_\+inc\+\_\+system\+\_\+thread\+\_\+count}} ()
\begin{DoxyCompactList}\small\item\em Increment the number of internal framework threads running. This should be called by each framework thread that has been started. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{mato__core_8c_a87731b4b9da695d14f237dc6825c9186}{mato\+\_\+dec\+\_\+system\+\_\+thread\+\_\+count}} ()
\begin{DoxyCompactList}\small\item\em Decrement the number of internal framework threads running. It should be called by each framework thread that terminates. \end{DoxyCompactList}\item 
int \mbox{\hyperlink{mato__core_8c_a9dfe1d249e65f9c9277279f03c54c90f}{mato\+\_\+system\+\_\+threads\+\_\+running}} ()
\begin{DoxyCompactList}\small\item\em The number of mato system threads that are currently running (not terminated yet). \end{DoxyCompactList}\item 
G\+List $\ast$ \mbox{\hyperlink{mato__core_8c_a948891305b2d86ead8d8b9e98ee992ea}{decrement\+\_\+references}} (G\+List $\ast$data\+\_\+buffers, \mbox{\hyperlink{structchannel__data}{channel\+\_\+data}} $\ast$to\+\_\+be\+\_\+decremented)
\begin{DoxyCompactList}\small\item\em Decrements the number of references to a particular buffer and deallocates the buffer itself as well as the structure describing the buffer. \end{DoxyCompactList}\item 
static void $\ast$ \mbox{\hyperlink{mato__core_8c_a3246af1e61c858d8e591f89ed34f43c1}{mato\+\_\+thread}} (void $\ast$arg)
\begin{DoxyCompactList}\small\item\em The main loop of the framework thread that takes care of redistributing all the messages posted by the modules. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{mato__core_8c_a7800709ec7535d9abc6454e510212d6c}{remove\+\_\+names\+\_\+types}} (int node\+\_\+id)
\item 
static void \mbox{\hyperlink{mato__core_8c_aa51b9879a8c773b51319c5467c5d19e1}{remove\+\_\+remote\+\_\+module\+\_\+from\+\_\+subscriptions}} (G\+Array $\ast$node\+\_\+subscriptions, int node, int node\+\_\+id\+\_\+of\+\_\+module, int module)
\begin{DoxyCompactList}\small\item\em A remote module has been deleted, we have to make sure it will not appear in the subscriptions anymore. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{mato__core_8c_a4bee50d9bc9c78f39d7f7cf6354a540d}{remove\+\_\+node\+\_\+from\+\_\+subscriptions}} (int node\+\_\+id)
\item 
void \mbox{\hyperlink{mato__core_8c_afdc3809f243d54fc76dd0539fbd847f0}{remove\+\_\+node\+\_\+buffers}} (int node\+\_\+id)
\item 
void \mbox{\hyperlink{mato__core_8c_af4e477c79e3ad08d61c3d4473baea950}{store\+\_\+new\+\_\+remote\+\_\+module}} (int node\+\_\+id, int module\+\_\+id, char $\ast$module\+\_\+name, char $\ast$module\+\_\+type, int number\+\_\+of\+\_\+channels)
\begin{DoxyCompactList}\small\item\em Update internal data structures as necessary when a new module announcement arrives from another node. \end{DoxyCompactList}\item 
int \mbox{\hyperlink{mato__core_8c_ae97dbf0eeadf4345327dcf392d02c30c}{get\+\_\+free\+\_\+module\+\_\+id}} ()
\begin{DoxyCompactList}\small\item\em Returns the next available module\+\_\+id. \end{DoxyCompactList}\item 
int \mbox{\hyperlink{mato__core_8c_aa96455f34de227205787b911dbe51847}{get\+\_\+free\+\_\+subscription\+\_\+id}} ()
\begin{DoxyCompactList}\small\item\em Returns the next available subscription\+\_\+id. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{mato__core_8c_a979625f0ce491a3abd1eb68ca93d803b}{remove\+\_\+subscription}} (int subscribed\+\_\+node\+\_\+id, int subscribed\+\_\+module\+\_\+id, int channel, int subscription\+\_\+id)
\item 
\mbox{\hyperlink{structmodule__info}{module\+\_\+info}} $\ast$ \mbox{\hyperlink{mato__core_8c_a041903e9b52f56435f88cff5f41aff3e}{new\+\_\+module\+\_\+info}} (int node\+\_\+id, int module\+\_\+id, char $\ast$module\+\_\+name, char $\ast$module\+\_\+type)
\begin{DoxyCompactList}\small\item\em A constructor for the \mbox{\hyperlink{structmodule__info}{module\+\_\+info}} structure. \end{DoxyCompactList}\item 
static void \mbox{\hyperlink{mato__core_8c_ab8c7efafd11208c96bcb070bfa5c11c6}{int\+Handler}} (int signum)
\begin{DoxyCompactList}\small\item\em signal handler, intercept C\+T\+R\+L-\/C \end{DoxyCompactList}\item 
void \mbox{\hyperlink{mato__core_8c_af1150c35e05b0d14d3e5e6f064558d83}{core\+\_\+mato\+\_\+init}} ()
\begin{DoxyCompactList}\small\item\em Initialize data structures maintained by the core. \end{DoxyCompactList}\item 
\mbox{\hyperlink{structchannel__data}{channel\+\_\+data}} $\ast$ \mbox{\hyperlink{mato__core_8c_a2da0b2b93801c2136969b06d8045ac69}{new\+\_\+channel\+\_\+data}} (int node\+\_\+id, int module\+\_\+id, int channel\+\_\+id, int length, void $\ast$data)
\begin{DoxyCompactList}\small\item\em A constructor for the \mbox{\hyperlink{structchannel__data}{channel\+\_\+data}} structure. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{mato__core_8c_a8ee143235f543184363dea746b824056}{subscribe\+\_\+channel\+\_\+from\+\_\+remote\+\_\+node}} (int remote\+\_\+node\+\_\+id, int subscribed\+\_\+module\+\_\+id, int channel)
\begin{DoxyCompactList}\small\item\em Update internal subscriptions\+: a remote node subscribing to our module\textquotesingle{}s channel. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{mato__core_8c_a53fa60389c0d5ac17eb194e386d89ad2}{unsubscribe\+\_\+channel\+\_\+from\+\_\+remote\+\_\+node}} (int remote\+\_\+node\+\_\+id, int subscribed\+\_\+module\+\_\+id, int channel)
\begin{DoxyCompactList}\small\item\em Update internal subscriptions\+: a remote node unsubscribing to our module\textquotesingle{}s channel. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{mato__core_8c_a46237792544cdb9542f03f0504d3a73f}{pack\+\_\+and\+\_\+send\+\_\+data\+\_\+to\+\_\+remote}} (int remote\+\_\+node\+\_\+id, int module\+\_\+id, int channel, int get\+\_\+data\+\_\+id)
\begin{DoxyCompactList}\small\item\em Remote module is requesting data from our channel, retrieve them and send back. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{mato__core_8c_ad4f4c0cf2b22dad78c8d00bc9c975ab8}{return\+\_\+data\+\_\+to\+\_\+waiting\+\_\+module}} (int get\+\_\+data\+\_\+id, int32\+\_\+t data\+\_\+length, uint8\+\_\+t $\ast$data)
\item 
void \mbox{\hyperlink{mato__core_8c_a5e81c3dd52599310f9ae512214c80ad1}{copy\+\_\+of\+\_\+last\+\_\+data\+\_\+of\+\_\+channel}} (int node\+\_\+id, int module\+\_\+id, int channel, int $\ast$data\+\_\+length, uint8\+\_\+t $\ast$$\ast$data)
\begin{DoxyCompactList}\small\item\em From buffers, retrieve the most recent message from a specified module/channel, make a copy of it and return the pointer to and size of the message in the $\ast$data\+\_\+length and $\ast$data variables. \end{DoxyCompactList}\end{DoxyCompactItemize}
\doxysubsection*{Variables}
\begin{DoxyCompactItemize}
\item 
volatile int \mbox{\hyperlink{mato__core_8c_a0f80851fe27966d69a2a0dfbafdb7160}{program\+\_\+runs}}
\begin{DoxyCompactList}\small\item\em This variable is set to non-\/zero when the program is about to terminate. \end{DoxyCompactList}\item 
volatile int \mbox{\hyperlink{mato__core_8c_a23868df494ffd83e64765b50b2f59de0}{threads\+\_\+started}}
\begin{DoxyCompactList}\small\item\em Contains the number of threads that are running. Use the functions \mbox{\hyperlink{mato_8c_a6b31044a7afec17426ec4d4e3354aa9f}{mato\+\_\+inc\+\_\+thread\+\_\+count()}} and \mbox{\hyperlink{mato_8c_a480acc181ff3a7d7c925d64e3d4a7442}{mato\+\_\+dec\+\_\+thread\+\_\+count()}}. \end{DoxyCompactList}\item 
volatile int \mbox{\hyperlink{mato__core_8c_acc307467ee069828e40a521f193e8b80}{system\+\_\+threads\+\_\+started}}
\begin{DoxyCompactList}\small\item\em Contains the number of internal framework threads that are running. Use the functions \mbox{\hyperlink{mato__core_8h_a94a6b505bcf5e3cca4665cba3bbab3cd}{mato\+\_\+inc\+\_\+system\+\_\+thread\+\_\+count()}} and \mbox{\hyperlink{mato__core_8h_a87731b4b9da695d14f237dc6825c9186}{mato\+\_\+dec\+\_\+system\+\_\+thread\+\_\+count()}}. \end{DoxyCompactList}\item 
G\+Array $\ast$ \mbox{\hyperlink{mato__core_8c_a7ccdd7e11e9c4bbf1887270e9d74779a}{module\+\_\+names}}
\begin{DoxyCompactList}\small\item\em Contains list of names of all module instances. \end{DoxyCompactList}\item 
G\+Array $\ast$ \mbox{\hyperlink{mato__core_8c_a2f565b6876bed976cee1f43eaa6d6787}{module\+\_\+types}}
\begin{DoxyCompactList}\small\item\em Contains list of types of all module instances. \end{DoxyCompactList}\item 
G\+Array $\ast$ \mbox{\hyperlink{mato__core_8c_a0e0d7e8d878428833528a1123d6558c5}{instance\+\_\+data}}
\begin{DoxyCompactList}\small\item\em Contains pointers to instance\+\_\+data of all module instances as returned by their create\+\_\+instance\+\_\+callback. \end{DoxyCompactList}\item 
G\+Hash\+Table $\ast$ \mbox{\hyperlink{mato__core_8c_a8cc125cf88b5a24be8ced43b9f710a19}{module\+\_\+specifications}}
\begin{DoxyCompactList}\small\item\em Contains \mbox{\hyperlink{structmodule__specification}{module\+\_\+specification}} structures for all type names. \end{DoxyCompactList}\item 
G\+Array $\ast$ \mbox{\hyperlink{mato__core_8c_a2822a291e85d87882c86a179b50c99f6}{buffers}}
\begin{DoxyCompactList}\small\item\em Data of all messages that are maintained by the framework at any point of time are kept in this G\+Array. \end{DoxyCompactList}\item 
G\+Array $\ast$ \mbox{\hyperlink{mato__core_8c_a08a6dc7b239323f6dbb221f209b6f518}{subscriptions}}
\begin{DoxyCompactList}\small\item\em Contains all descriptions of subscriptions, instances of subscription structures. \end{DoxyCompactList}\item 
int \mbox{\hyperlink{mato__core_8c_a225d8d1a4c4e855493b258620e5e2be4}{post\+\_\+data\+\_\+pipe}} \mbox{[}2\mbox{]}
\begin{DoxyCompactList}\small\item\em New messages that are posted by the modules are allocated in dynamic memory. \end{DoxyCompactList}\item 
static int \mbox{\hyperlink{mato__core_8c_aa6e2f37fb2e955b97bacbbd53876850a}{next\+\_\+free\+\_\+module\+\_\+id}}
\begin{DoxyCompactList}\small\item\em A counter for assigning a new module\+\_\+id for newly created module instances. \end{DoxyCompactList}\item 
static int \mbox{\hyperlink{mato__core_8c_a3c68d041defa2734c56413420d572c2a}{next\+\_\+free\+\_\+subscription\+\_\+id}}
\begin{DoxyCompactList}\small\item\em A counter for assining a new subscription\+\_\+id for newly registered subscriptions. \end{DoxyCompactList}\item 
static pthread\+\_\+mutex\+\_\+t \mbox{\hyperlink{mato__core_8c_ace00a3e120249460a8acf8381667cc75}{framework\+\_\+mutex}}
\begin{DoxyCompactList}\small\item\em Used for mutual exclusion when accessing framework structures from functions that can be called from different threads. \end{DoxyCompactList}\end{DoxyCompactItemize}


\doxysubsection{Detailed Description}
Implementation of the Mato control framework -\/ internal data structures and algorithms. 

\doxysubsection{Macro Definition Documentation}
\mbox{\Hypertarget{mato__core_8c_a369266c24eacffb87046522897a570d5}\label{mato__core_8c_a369266c24eacffb87046522897a570d5}} 
\index{mato\_core.c@{mato\_core.c}!\_GNU\_SOURCE@{\_GNU\_SOURCE}}
\index{\_GNU\_SOURCE@{\_GNU\_SOURCE}!mato\_core.c@{mato\_core.c}}
\doxysubsubsection{\texorpdfstring{\_GNU\_SOURCE}{\_GNU\_SOURCE}}
{\footnotesize\ttfamily \#define \+\_\+\+G\+N\+U\+\_\+\+S\+O\+U\+R\+CE}



\doxysubsection{Function Documentation}
\mbox{\Hypertarget{mato__core_8c_a5e81c3dd52599310f9ae512214c80ad1}\label{mato__core_8c_a5e81c3dd52599310f9ae512214c80ad1}} 
\index{mato\_core.c@{mato\_core.c}!copy\_of\_last\_data\_of\_channel@{copy\_of\_last\_data\_of\_channel}}
\index{copy\_of\_last\_data\_of\_channel@{copy\_of\_last\_data\_of\_channel}!mato\_core.c@{mato\_core.c}}
\doxysubsubsection{\texorpdfstring{copy\_of\_last\_data\_of\_channel()}{copy\_of\_last\_data\_of\_channel()}}
{\footnotesize\ttfamily void copy\+\_\+of\+\_\+last\+\_\+data\+\_\+of\+\_\+channel (\begin{DoxyParamCaption}\item[{int}]{node\+\_\+id,  }\item[{int}]{module\+\_\+id,  }\item[{int}]{channel,  }\item[{int $\ast$}]{data\+\_\+length,  }\item[{uint8\+\_\+t $\ast$$\ast$}]{data }\end{DoxyParamCaption})}



From buffers, retrieve the most recent message from a specified module/channel, make a copy of it and return the pointer to and size of the message in the $\ast$data\+\_\+length and $\ast$data variables. 

If there is no data posted by that module yet, both $\ast$data\+\_\+length and $\ast$data will be 0. \mbox{\Hypertarget{mato__core_8c_af1150c35e05b0d14d3e5e6f064558d83}\label{mato__core_8c_af1150c35e05b0d14d3e5e6f064558d83}} 
\index{mato\_core.c@{mato\_core.c}!core\_mato\_init@{core\_mato\_init}}
\index{core\_mato\_init@{core\_mato\_init}!mato\_core.c@{mato\_core.c}}
\doxysubsubsection{\texorpdfstring{core\_mato\_init()}{core\_mato\_init()}}
{\footnotesize\ttfamily void core\+\_\+mato\+\_\+init (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}



Initialize data structures maintained by the core. 

\mbox{\Hypertarget{mato__core_8c_a0d4eb232de3e0d9c18edc91eb1316421}\label{mato__core_8c_a0d4eb232de3e0d9c18edc91eb1316421}} 
\index{mato\_core.c@{mato\_core.c}!core\_mato\_shutdown@{core\_mato\_shutdown}}
\index{core\_mato\_shutdown@{core\_mato\_shutdown}!mato\_core.c@{mato\_core.c}}
\doxysubsubsection{\texorpdfstring{core\_mato\_shutdown()}{core\_mato\_shutdown()}}
{\footnotesize\ttfamily void core\+\_\+mato\+\_\+shutdown (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}



Release resources used by the core. 

\mbox{\Hypertarget{mato__core_8c_a948891305b2d86ead8d8b9e98ee992ea}\label{mato__core_8c_a948891305b2d86ead8d8b9e98ee992ea}} 
\index{mato\_core.c@{mato\_core.c}!decrement\_references@{decrement\_references}}
\index{decrement\_references@{decrement\_references}!mato\_core.c@{mato\_core.c}}
\doxysubsubsection{\texorpdfstring{decrement\_references()}{decrement\_references()}}
{\footnotesize\ttfamily G\+List$\ast$ decrement\+\_\+references (\begin{DoxyParamCaption}\item[{G\+List $\ast$}]{data\+\_\+buffers,  }\item[{\mbox{\hyperlink{structchannel__data}{channel\+\_\+data}} $\ast$}]{to\+\_\+be\+\_\+decremented }\end{DoxyParamCaption})}



Decrements the number of references to a particular buffer and deallocates the buffer itself as well as the structure describing the buffer. 

It also removes it from the list of the framework-\/maintained messages. \mbox{\Hypertarget{mato__core_8c_ae97dbf0eeadf4345327dcf392d02c30c}\label{mato__core_8c_ae97dbf0eeadf4345327dcf392d02c30c}} 
\index{mato\_core.c@{mato\_core.c}!get\_free\_module\_id@{get\_free\_module\_id}}
\index{get\_free\_module\_id@{get\_free\_module\_id}!mato\_core.c@{mato\_core.c}}
\doxysubsubsection{\texorpdfstring{get\_free\_module\_id()}{get\_free\_module\_id()}}
{\footnotesize\ttfamily int get\+\_\+free\+\_\+module\+\_\+id (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}



Returns the next available module\+\_\+id. 

\mbox{\Hypertarget{mato__core_8c_aa96455f34de227205787b911dbe51847}\label{mato__core_8c_aa96455f34de227205787b911dbe51847}} 
\index{mato\_core.c@{mato\_core.c}!get\_free\_subscription\_id@{get\_free\_subscription\_id}}
\index{get\_free\_subscription\_id@{get\_free\_subscription\_id}!mato\_core.c@{mato\_core.c}}
\doxysubsubsection{\texorpdfstring{get\_free\_subscription\_id()}{get\_free\_subscription\_id()}}
{\footnotesize\ttfamily int get\+\_\+free\+\_\+subscription\+\_\+id (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}



Returns the next available subscription\+\_\+id. 

\mbox{\Hypertarget{mato__core_8c_ab8c7efafd11208c96bcb070bfa5c11c6}\label{mato__core_8c_ab8c7efafd11208c96bcb070bfa5c11c6}} 
\index{mato\_core.c@{mato\_core.c}!intHandler@{intHandler}}
\index{intHandler@{intHandler}!mato\_core.c@{mato\_core.c}}
\doxysubsubsection{\texorpdfstring{intHandler()}{intHandler()}}
{\footnotesize\ttfamily static void int\+Handler (\begin{DoxyParamCaption}\item[{int}]{signum }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [static]}}



signal handler, intercept C\+T\+R\+L-\/C 

\mbox{\Hypertarget{mato__core_8c_a438cf6032d01d451d50cf8cd7b14d8f0}\label{mato__core_8c_a438cf6032d01d451d50cf8cd7b14d8f0}} 
\index{mato\_core.c@{mato\_core.c}!lock\_framework@{lock\_framework}}
\index{lock\_framework@{lock\_framework}!mato\_core.c@{mato\_core.c}}
\doxysubsubsection{\texorpdfstring{lock\_framework()}{lock\_framework()}}
{\footnotesize\ttfamily void lock\+\_\+framework (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}



Enter mutually-\/exclusive area accessing internal framework data structures. 

\mbox{\Hypertarget{mato__core_8c_a87731b4b9da695d14f237dc6825c9186}\label{mato__core_8c_a87731b4b9da695d14f237dc6825c9186}} 
\index{mato\_core.c@{mato\_core.c}!mato\_dec\_system\_thread\_count@{mato\_dec\_system\_thread\_count}}
\index{mato\_dec\_system\_thread\_count@{mato\_dec\_system\_thread\_count}!mato\_core.c@{mato\_core.c}}
\doxysubsubsection{\texorpdfstring{mato\_dec\_system\_thread\_count()}{mato\_dec\_system\_thread\_count()}}
{\footnotesize\ttfamily void mato\+\_\+dec\+\_\+system\+\_\+thread\+\_\+count (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}



Decrement the number of internal framework threads running. It should be called by each framework thread that terminates. 

\mbox{\Hypertarget{mato__core_8c_a94a6b505bcf5e3cca4665cba3bbab3cd}\label{mato__core_8c_a94a6b505bcf5e3cca4665cba3bbab3cd}} 
\index{mato\_core.c@{mato\_core.c}!mato\_inc\_system\_thread\_count@{mato\_inc\_system\_thread\_count}}
\index{mato\_inc\_system\_thread\_count@{mato\_inc\_system\_thread\_count}!mato\_core.c@{mato\_core.c}}
\doxysubsubsection{\texorpdfstring{mato\_inc\_system\_thread\_count()}{mato\_inc\_system\_thread\_count()}}
{\footnotesize\ttfamily void mato\+\_\+inc\+\_\+system\+\_\+thread\+\_\+count (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}



Increment the number of internal framework threads running. This should be called by each framework thread that has been started. 

\mbox{\Hypertarget{mato__core_8c_a9dfe1d249e65f9c9277279f03c54c90f}\label{mato__core_8c_a9dfe1d249e65f9c9277279f03c54c90f}} 
\index{mato\_core.c@{mato\_core.c}!mato\_system\_threads\_running@{mato\_system\_threads\_running}}
\index{mato\_system\_threads\_running@{mato\_system\_threads\_running}!mato\_core.c@{mato\_core.c}}
\doxysubsubsection{\texorpdfstring{mato\_system\_threads\_running()}{mato\_system\_threads\_running()}}
{\footnotesize\ttfamily int mato\+\_\+system\+\_\+threads\+\_\+running (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}



The number of mato system threads that are currently running (not terminated yet). 

\mbox{\Hypertarget{mato__core_8c_a3246af1e61c858d8e591f89ed34f43c1}\label{mato__core_8c_a3246af1e61c858d8e591f89ed34f43c1}} 
\index{mato\_core.c@{mato\_core.c}!mato\_thread@{mato\_thread}}
\index{mato\_thread@{mato\_thread}!mato\_core.c@{mato\_core.c}}
\doxysubsubsection{\texorpdfstring{mato\_thread()}{mato\_thread()}}
{\footnotesize\ttfamily static void$\ast$ mato\+\_\+thread (\begin{DoxyParamCaption}\item[{void $\ast$}]{arg }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [static]}}



The main loop of the framework thread that takes care of redistributing all the messages posted by the modules. 

\mbox{\Hypertarget{mato__core_8c_a2da0b2b93801c2136969b06d8045ac69}\label{mato__core_8c_a2da0b2b93801c2136969b06d8045ac69}} 
\index{mato\_core.c@{mato\_core.c}!new\_channel\_data@{new\_channel\_data}}
\index{new\_channel\_data@{new\_channel\_data}!mato\_core.c@{mato\_core.c}}
\doxysubsubsection{\texorpdfstring{new\_channel\_data()}{new\_channel\_data()}}
{\footnotesize\ttfamily \mbox{\hyperlink{structchannel__data}{channel\+\_\+data}}$\ast$ new\+\_\+channel\+\_\+data (\begin{DoxyParamCaption}\item[{int}]{node\+\_\+id,  }\item[{int}]{module\+\_\+id,  }\item[{int}]{channel\+\_\+id,  }\item[{int}]{length,  }\item[{void $\ast$}]{data }\end{DoxyParamCaption})}



A constructor for the \mbox{\hyperlink{structchannel__data}{channel\+\_\+data}} structure. 

\mbox{\Hypertarget{mato__core_8c_a041903e9b52f56435f88cff5f41aff3e}\label{mato__core_8c_a041903e9b52f56435f88cff5f41aff3e}} 
\index{mato\_core.c@{mato\_core.c}!new\_module\_info@{new\_module\_info}}
\index{new\_module\_info@{new\_module\_info}!mato\_core.c@{mato\_core.c}}
\doxysubsubsection{\texorpdfstring{new\_module\_info()}{new\_module\_info()}}
{\footnotesize\ttfamily \mbox{\hyperlink{structmodule__info}{module\+\_\+info}}$\ast$ new\+\_\+module\+\_\+info (\begin{DoxyParamCaption}\item[{int}]{node\+\_\+id,  }\item[{int}]{module\+\_\+id,  }\item[{char $\ast$}]{module\+\_\+name,  }\item[{char $\ast$}]{module\+\_\+type }\end{DoxyParamCaption})}



A constructor for the \mbox{\hyperlink{structmodule__info}{module\+\_\+info}} structure. 

\mbox{\Hypertarget{mato__core_8c_a46237792544cdb9542f03f0504d3a73f}\label{mato__core_8c_a46237792544cdb9542f03f0504d3a73f}} 
\index{mato\_core.c@{mato\_core.c}!pack\_and\_send\_data\_to\_remote@{pack\_and\_send\_data\_to\_remote}}
\index{pack\_and\_send\_data\_to\_remote@{pack\_and\_send\_data\_to\_remote}!mato\_core.c@{mato\_core.c}}
\doxysubsubsection{\texorpdfstring{pack\_and\_send\_data\_to\_remote()}{pack\_and\_send\_data\_to\_remote()}}
{\footnotesize\ttfamily void pack\+\_\+and\+\_\+send\+\_\+data\+\_\+to\+\_\+remote (\begin{DoxyParamCaption}\item[{int}]{remote\+\_\+node\+\_\+id,  }\item[{int}]{module\+\_\+id,  }\item[{int}]{channel,  }\item[{int}]{get\+\_\+data\+\_\+id }\end{DoxyParamCaption})}



Remote module is requesting data from our channel, retrieve them and send back. 

\mbox{\Hypertarget{mato__core_8c_a7800709ec7535d9abc6454e510212d6c}\label{mato__core_8c_a7800709ec7535d9abc6454e510212d6c}} 
\index{mato\_core.c@{mato\_core.c}!remove\_names\_types@{remove\_names\_types}}
\index{remove\_names\_types@{remove\_names\_types}!mato\_core.c@{mato\_core.c}}
\doxysubsubsection{\texorpdfstring{remove\_names\_types()}{remove\_names\_types()}}
{\footnotesize\ttfamily void remove\+\_\+names\+\_\+types (\begin{DoxyParamCaption}\item[{int}]{node\+\_\+id }\end{DoxyParamCaption})}

\mbox{\Hypertarget{mato__core_8c_afdc3809f243d54fc76dd0539fbd847f0}\label{mato__core_8c_afdc3809f243d54fc76dd0539fbd847f0}} 
\index{mato\_core.c@{mato\_core.c}!remove\_node\_buffers@{remove\_node\_buffers}}
\index{remove\_node\_buffers@{remove\_node\_buffers}!mato\_core.c@{mato\_core.c}}
\doxysubsubsection{\texorpdfstring{remove\_node\_buffers()}{remove\_node\_buffers()}}
{\footnotesize\ttfamily void remove\+\_\+node\+\_\+buffers (\begin{DoxyParamCaption}\item[{int}]{node\+\_\+id }\end{DoxyParamCaption})}

\mbox{\Hypertarget{mato__core_8c_a4bee50d9bc9c78f39d7f7cf6354a540d}\label{mato__core_8c_a4bee50d9bc9c78f39d7f7cf6354a540d}} 
\index{mato\_core.c@{mato\_core.c}!remove\_node\_from\_subscriptions@{remove\_node\_from\_subscriptions}}
\index{remove\_node\_from\_subscriptions@{remove\_node\_from\_subscriptions}!mato\_core.c@{mato\_core.c}}
\doxysubsubsection{\texorpdfstring{remove\_node\_from\_subscriptions()}{remove\_node\_from\_subscriptions()}}
{\footnotesize\ttfamily void remove\+\_\+node\+\_\+from\+\_\+subscriptions (\begin{DoxyParamCaption}\item[{int}]{node\+\_\+id }\end{DoxyParamCaption})}

\mbox{\Hypertarget{mato__core_8c_aa51b9879a8c773b51319c5467c5d19e1}\label{mato__core_8c_aa51b9879a8c773b51319c5467c5d19e1}} 
\index{mato\_core.c@{mato\_core.c}!remove\_remote\_module\_from\_subscriptions@{remove\_remote\_module\_from\_subscriptions}}
\index{remove\_remote\_module\_from\_subscriptions@{remove\_remote\_module\_from\_subscriptions}!mato\_core.c@{mato\_core.c}}
\doxysubsubsection{\texorpdfstring{remove\_remote\_module\_from\_subscriptions()}{remove\_remote\_module\_from\_subscriptions()}}
{\footnotesize\ttfamily static void remove\+\_\+remote\+\_\+module\+\_\+from\+\_\+subscriptions (\begin{DoxyParamCaption}\item[{G\+Array $\ast$}]{node\+\_\+subscriptions,  }\item[{int}]{node,  }\item[{int}]{node\+\_\+id\+\_\+of\+\_\+module,  }\item[{int}]{module }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [static]}}



A remote module has been deleted, we have to make sure it will not appear in the subscriptions anymore. 

\mbox{\Hypertarget{mato__core_8c_a979625f0ce491a3abd1eb68ca93d803b}\label{mato__core_8c_a979625f0ce491a3abd1eb68ca93d803b}} 
\index{mato\_core.c@{mato\_core.c}!remove\_subscription@{remove\_subscription}}
\index{remove\_subscription@{remove\_subscription}!mato\_core.c@{mato\_core.c}}
\doxysubsubsection{\texorpdfstring{remove\_subscription()}{remove\_subscription()}}
{\footnotesize\ttfamily void remove\+\_\+subscription (\begin{DoxyParamCaption}\item[{int}]{subscribed\+\_\+node\+\_\+id,  }\item[{int}]{subscribed\+\_\+module\+\_\+id,  }\item[{int}]{channel,  }\item[{int}]{subscription\+\_\+id }\end{DoxyParamCaption})}

\mbox{\Hypertarget{mato__core_8c_ad4f4c0cf2b22dad78c8d00bc9c975ab8}\label{mato__core_8c_ad4f4c0cf2b22dad78c8d00bc9c975ab8}} 
\index{mato\_core.c@{mato\_core.c}!return\_data\_to\_waiting\_module@{return\_data\_to\_waiting\_module}}
\index{return\_data\_to\_waiting\_module@{return\_data\_to\_waiting\_module}!mato\_core.c@{mato\_core.c}}
\doxysubsubsection{\texorpdfstring{return\_data\_to\_waiting\_module()}{return\_data\_to\_waiting\_module()}}
{\footnotesize\ttfamily void return\+\_\+data\+\_\+to\+\_\+waiting\+\_\+module (\begin{DoxyParamCaption}\item[{int}]{get\+\_\+data\+\_\+id,  }\item[{int32\+\_\+t}]{data\+\_\+length,  }\item[{uint8\+\_\+t $\ast$}]{data }\end{DoxyParamCaption})}

\mbox{\Hypertarget{mato__core_8c_af4e477c79e3ad08d61c3d4473baea950}\label{mato__core_8c_af4e477c79e3ad08d61c3d4473baea950}} 
\index{mato\_core.c@{mato\_core.c}!store\_new\_remote\_module@{store\_new\_remote\_module}}
\index{store\_new\_remote\_module@{store\_new\_remote\_module}!mato\_core.c@{mato\_core.c}}
\doxysubsubsection{\texorpdfstring{store\_new\_remote\_module()}{store\_new\_remote\_module()}}
{\footnotesize\ttfamily void store\+\_\+new\+\_\+remote\+\_\+module (\begin{DoxyParamCaption}\item[{int}]{node\+\_\+id,  }\item[{int}]{module\+\_\+id,  }\item[{char $\ast$}]{module\+\_\+name,  }\item[{char $\ast$}]{module\+\_\+type,  }\item[{int}]{number\+\_\+of\+\_\+channels }\end{DoxyParamCaption})}



Update internal data structures as necessary when a new module announcement arrives from another node. 

\mbox{\Hypertarget{mato__core_8c_a8ee143235f543184363dea746b824056}\label{mato__core_8c_a8ee143235f543184363dea746b824056}} 
\index{mato\_core.c@{mato\_core.c}!subscribe\_channel\_from\_remote\_node@{subscribe\_channel\_from\_remote\_node}}
\index{subscribe\_channel\_from\_remote\_node@{subscribe\_channel\_from\_remote\_node}!mato\_core.c@{mato\_core.c}}
\doxysubsubsection{\texorpdfstring{subscribe\_channel\_from\_remote\_node()}{subscribe\_channel\_from\_remote\_node()}}
{\footnotesize\ttfamily void subscribe\+\_\+channel\+\_\+from\+\_\+remote\+\_\+node (\begin{DoxyParamCaption}\item[{int}]{remote\+\_\+node\+\_\+id,  }\item[{int}]{subscribed\+\_\+module\+\_\+id,  }\item[{int}]{channel }\end{DoxyParamCaption})}



Update internal subscriptions\+: a remote node subscribing to our module\textquotesingle{}s channel. 

\mbox{\Hypertarget{mato__core_8c_a39c60cf29218c107f4115b73270a5114}\label{mato__core_8c_a39c60cf29218c107f4115b73270a5114}} 
\index{mato\_core.c@{mato\_core.c}!unlock\_framework@{unlock\_framework}}
\index{unlock\_framework@{unlock\_framework}!mato\_core.c@{mato\_core.c}}
\doxysubsubsection{\texorpdfstring{unlock\_framework()}{unlock\_framework()}}
{\footnotesize\ttfamily void unlock\+\_\+framework (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}



Leave mutually-\/exclusive area with a protected acces to internal framework data structures. 

\mbox{\Hypertarget{mato__core_8c_a53fa60389c0d5ac17eb194e386d89ad2}\label{mato__core_8c_a53fa60389c0d5ac17eb194e386d89ad2}} 
\index{mato\_core.c@{mato\_core.c}!unsubscribe\_channel\_from\_remote\_node@{unsubscribe\_channel\_from\_remote\_node}}
\index{unsubscribe\_channel\_from\_remote\_node@{unsubscribe\_channel\_from\_remote\_node}!mato\_core.c@{mato\_core.c}}
\doxysubsubsection{\texorpdfstring{unsubscribe\_channel\_from\_remote\_node()}{unsubscribe\_channel\_from\_remote\_node()}}
{\footnotesize\ttfamily void unsubscribe\+\_\+channel\+\_\+from\+\_\+remote\+\_\+node (\begin{DoxyParamCaption}\item[{int}]{remote\+\_\+node\+\_\+id,  }\item[{int}]{subscribed\+\_\+module\+\_\+id,  }\item[{int}]{channel }\end{DoxyParamCaption})}



Update internal subscriptions\+: a remote node unsubscribing to our module\textquotesingle{}s channel. 



\doxysubsection{Variable Documentation}
\mbox{\Hypertarget{mato__core_8c_a2822a291e85d87882c86a179b50c99f6}\label{mato__core_8c_a2822a291e85d87882c86a179b50c99f6}} 
\index{mato\_core.c@{mato\_core.c}!buffers@{buffers}}
\index{buffers@{buffers}!mato\_core.c@{mato\_core.c}}
\doxysubsubsection{\texorpdfstring{buffers}{buffers}}
{\footnotesize\ttfamily G\+Array$\ast$ buffers}



Data of all messages that are maintained by the framework at any point of time are kept in this G\+Array. 

It is indexed by module\+\_\+id and contains G\+Arrays indexed by channel number of the particular module instance. Finally, the elements of the nested G\+Array are G\+Lists -\/ the list of all messages of the particular module in its particular channel that are still needed by the framework or any other module and thus have not been deallocated. Each time a module posts a new message to its channel, it is added to that list. The message is removed from the list when it has have been forwarded to all the subscribers, no subscriber or another module has borrowed a pointer to it and a new message from the module on the same channel has already arrived. \mbox{\Hypertarget{mato__core_8c_ace00a3e120249460a8acf8381667cc75}\label{mato__core_8c_ace00a3e120249460a8acf8381667cc75}} 
\index{mato\_core.c@{mato\_core.c}!framework\_mutex@{framework\_mutex}}
\index{framework\_mutex@{framework\_mutex}!mato\_core.c@{mato\_core.c}}
\doxysubsubsection{\texorpdfstring{framework\_mutex}{framework\_mutex}}
{\footnotesize\ttfamily pthread\+\_\+mutex\+\_\+t framework\+\_\+mutex\hspace{0.3cm}{\ttfamily [static]}}



Used for mutual exclusion when accessing framework structures from functions that can be called from different threads. 

\mbox{\Hypertarget{mato__core_8c_a0e0d7e8d878428833528a1123d6558c5}\label{mato__core_8c_a0e0d7e8d878428833528a1123d6558c5}} 
\index{mato\_core.c@{mato\_core.c}!instance\_data@{instance\_data}}
\index{instance\_data@{instance\_data}!mato\_core.c@{mato\_core.c}}
\doxysubsubsection{\texorpdfstring{instance\_data}{instance\_data}}
{\footnotesize\ttfamily G\+Array$\ast$ instance\+\_\+data}



Contains pointers to instance\+\_\+data of all module instances as returned by their create\+\_\+instance\+\_\+callback. 

The G\+Array is indexed by module\+\_\+id. After a particular module is deleted, its module\+\_\+id and the location in this array will remain unused. \mbox{\Hypertarget{mato__core_8c_a7ccdd7e11e9c4bbf1887270e9d74779a}\label{mato__core_8c_a7ccdd7e11e9c4bbf1887270e9d74779a}} 
\index{mato\_core.c@{mato\_core.c}!module\_names@{module\_names}}
\index{module\_names@{module\_names}!mato\_core.c@{mato\_core.c}}
\doxysubsubsection{\texorpdfstring{module\_names}{module\_names}}
{\footnotesize\ttfamily G\+Array$\ast$ module\+\_\+names}



Contains list of names of all module instances. 

The G\+Array is indexed by module\+\_\+id. After a particular module is deleted, its module\+\_\+id and the location in this array will remain unused. \mbox{\Hypertarget{mato__core_8c_a8cc125cf88b5a24be8ced43b9f710a19}\label{mato__core_8c_a8cc125cf88b5a24be8ced43b9f710a19}} 
\index{mato\_core.c@{mato\_core.c}!module\_specifications@{module\_specifications}}
\index{module\_specifications@{module\_specifications}!mato\_core.c@{mato\_core.c}}
\doxysubsubsection{\texorpdfstring{module\_specifications}{module\_specifications}}
{\footnotesize\ttfamily G\+Hash\+Table$\ast$ module\+\_\+specifications}



Contains \mbox{\hyperlink{structmodule__specification}{module\+\_\+specification}} structures for all type names. 

The keys in this hashtable are the module types. The value is a pointer to \mbox{\hyperlink{structmodule__specification}{module\+\_\+specification}} structure as provided by the argument to \mbox{\hyperlink{mato_8c_a43f0570e3ab59d7a021e93113437dcaf}{mato\+\_\+register\+\_\+new\+\_\+type\+\_\+of\+\_\+module()}} function that is typically called from the init function of a module type. \mbox{\Hypertarget{mato__core_8c_a2f565b6876bed976cee1f43eaa6d6787}\label{mato__core_8c_a2f565b6876bed976cee1f43eaa6d6787}} 
\index{mato\_core.c@{mato\_core.c}!module\_types@{module\_types}}
\index{module\_types@{module\_types}!mato\_core.c@{mato\_core.c}}
\doxysubsubsection{\texorpdfstring{module\_types}{module\_types}}
{\footnotesize\ttfamily G\+Array$\ast$ module\+\_\+types}



Contains list of types of all module instances. 

The G\+Array is indexed by module\+\_\+id. After a particular module is deleted, its module\+\_\+id and the location in this array will remain unused. \mbox{\Hypertarget{mato__core_8c_aa6e2f37fb2e955b97bacbbd53876850a}\label{mato__core_8c_aa6e2f37fb2e955b97bacbbd53876850a}} 
\index{mato\_core.c@{mato\_core.c}!next\_free\_module\_id@{next\_free\_module\_id}}
\index{next\_free\_module\_id@{next\_free\_module\_id}!mato\_core.c@{mato\_core.c}}
\doxysubsubsection{\texorpdfstring{next\_free\_module\_id}{next\_free\_module\_id}}
{\footnotesize\ttfamily int next\+\_\+free\+\_\+module\+\_\+id\hspace{0.3cm}{\ttfamily [static]}}



A counter for assigning a new module\+\_\+id for newly created module instances. 

\mbox{\Hypertarget{mato__core_8c_a3c68d041defa2734c56413420d572c2a}\label{mato__core_8c_a3c68d041defa2734c56413420d572c2a}} 
\index{mato\_core.c@{mato\_core.c}!next\_free\_subscription\_id@{next\_free\_subscription\_id}}
\index{next\_free\_subscription\_id@{next\_free\_subscription\_id}!mato\_core.c@{mato\_core.c}}
\doxysubsubsection{\texorpdfstring{next\_free\_subscription\_id}{next\_free\_subscription\_id}}
{\footnotesize\ttfamily int next\+\_\+free\+\_\+subscription\+\_\+id\hspace{0.3cm}{\ttfamily [static]}}



A counter for assining a new subscription\+\_\+id for newly registered subscriptions. 

\mbox{\Hypertarget{mato__core_8c_a225d8d1a4c4e855493b258620e5e2be4}\label{mato__core_8c_a225d8d1a4c4e855493b258620e5e2be4}} 
\index{mato\_core.c@{mato\_core.c}!post\_data\_pipe@{post\_data\_pipe}}
\index{post\_data\_pipe@{post\_data\_pipe}!mato\_core.c@{mato\_core.c}}
\doxysubsubsection{\texorpdfstring{post\_data\_pipe}{post\_data\_pipe}}
{\footnotesize\ttfamily int post\+\_\+data\+\_\+pipe\mbox{[}2\mbox{]}}



New messages that are posted by the modules are allocated in dynamic memory. 

Pointers to that memory enter this pipe and are picked up by a message redistribution loop that takes care of them in a serial manner. Handling of each message is supposed to be done very quickly -\/ assuming the subscriber callbacks return quickly. In the future release, we expect each subscriber callback to be called in a separate thread taken from a thread pool. \mbox{\Hypertarget{mato__core_8c_a0f80851fe27966d69a2a0dfbafdb7160}\label{mato__core_8c_a0f80851fe27966d69a2a0dfbafdb7160}} 
\index{mato\_core.c@{mato\_core.c}!program\_runs@{program\_runs}}
\index{program\_runs@{program\_runs}!mato\_core.c@{mato\_core.c}}
\doxysubsubsection{\texorpdfstring{program\_runs}{program\_runs}}
{\footnotesize\ttfamily volatile int program\+\_\+runs}



This variable is set to non-\/zero when the program is about to terminate. 

All threads should terminate at the earliest possbility \mbox{\Hypertarget{mato__core_8c_a08a6dc7b239323f6dbb221f209b6f518}\label{mato__core_8c_a08a6dc7b239323f6dbb221f209b6f518}} 
\index{mato\_core.c@{mato\_core.c}!subscriptions@{subscriptions}}
\index{subscriptions@{subscriptions}!mato\_core.c@{mato\_core.c}}
\doxysubsubsection{\texorpdfstring{subscriptions}{subscriptions}}
{\footnotesize\ttfamily G\+Array$\ast$ subscriptions}



Contains all descriptions of subscriptions, instances of subscription structures. 

The G\+Array is indexed by the module\+\_\+id and contains G\+Arrays indexed by channel number Finally, the nested G\+Array elements are again G\+Arrays containing all subscriptions to that particular channel of that particular module. \mbox{\Hypertarget{mato__core_8c_acc307467ee069828e40a521f193e8b80}\label{mato__core_8c_acc307467ee069828e40a521f193e8b80}} 
\index{mato\_core.c@{mato\_core.c}!system\_threads\_started@{system\_threads\_started}}
\index{system\_threads\_started@{system\_threads\_started}!mato\_core.c@{mato\_core.c}}
\doxysubsubsection{\texorpdfstring{system\_threads\_started}{system\_threads\_started}}
{\footnotesize\ttfamily volatile int system\+\_\+threads\+\_\+started}



Contains the number of internal framework threads that are running. Use the functions \mbox{\hyperlink{mato__core_8h_a94a6b505bcf5e3cca4665cba3bbab3cd}{mato\+\_\+inc\+\_\+system\+\_\+thread\+\_\+count()}} and \mbox{\hyperlink{mato__core_8h_a87731b4b9da695d14f237dc6825c9186}{mato\+\_\+dec\+\_\+system\+\_\+thread\+\_\+count()}}. 

\mbox{\Hypertarget{mato__core_8c_a23868df494ffd83e64765b50b2f59de0}\label{mato__core_8c_a23868df494ffd83e64765b50b2f59de0}} 
\index{mato\_core.c@{mato\_core.c}!threads\_started@{threads\_started}}
\index{threads\_started@{threads\_started}!mato\_core.c@{mato\_core.c}}
\doxysubsubsection{\texorpdfstring{threads\_started}{threads\_started}}
{\footnotesize\ttfamily volatile int threads\+\_\+started}



Contains the number of threads that are running. Use the functions \mbox{\hyperlink{mato_8c_a6b31044a7afec17426ec4d4e3354aa9f}{mato\+\_\+inc\+\_\+thread\+\_\+count()}} and \mbox{\hyperlink{mato_8c_a480acc181ff3a7d7c925d64e3d4a7442}{mato\+\_\+dec\+\_\+thread\+\_\+count()}}. 

